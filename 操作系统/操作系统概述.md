# 目录
   * [概述](#概述)
   * [进程与线程](#进程与线程)
   * [死锁](#死锁)
   * [内存管理](#内存管理)

----------------------------------------------------
# 概述

### 操作系统基本特征
1. 并发
   * 并发是指宏观上在一段时间内能同时运行多个程序，而并行则指同一时刻能运行多个指令。
   * 并行需要硬件支持，如多流水线、多核处理器或者分布式计算系统。
   * 操作系统通过引入进程和线程，使得程序能够并发运行。
   * 并发（concurrency）：指宏观上看起来两个程序在同时运行，比如说在单核cpu上的多任务。但是从微观上看两个程序的指令是交织着运行的，你的指令之间穿插着我的指令，我的指令之间穿插着你的，在单个周期内只运行了一个指令。这种并发并不能提高计算机的性能，只能提高效率。 
   * 并行（parallelism）：指严格物理意义上的同时运行，比如多核cpu，两个程序分别运行在两个核上，两者之间互不影响，单个周期内每个程序都运行了自己的指令，也就是运行了两条指令。这样说来并行的确提高了计算机的效率。所以现在的cpu都是往多核方面发展。 
2. 共享
   * 共享是指系统中的资源可以被多个并发进程共同使用。
   * 有两种共享方式：互斥共享和同时共享。
   * 互斥共享的资源称为临界资源，例如打印机等，在同一时刻只允许一个进程访问，需要用同步机制来实现互斥访问。
3. 虚拟
   * 虚拟技术把一个物理实体转换为多个逻辑实体。主要有两种虚拟技术：时（时间）分复用技术和空（空间）分复用技术。
   * 多个进程能在同一个处理器上并发执行使用了时分复用技术，让每个进程轮流占用处理器，每次只执行一小个时间片并快速切换。
   * 虚拟内存使用了空分复用技术，它将物理内存抽象为地址空间，每个进程都有各自的地址空间。地址空间的页被映射到物理内存，地址空间的页并不需要全部在物理内存中，当使用到一个没有在物理内存的页时，执行页面置换算法，将该页置换到内存中。
4. 异步
   * 异步指进程不是一次性执行完毕，而是走走停停，以不可知的速度向前推进。

### 操作系统基本功能
1. 进程管理  
进程控制、进程同步、进程通信、死锁处理、处理机调度等。
2. 内存管理  
内存分配、地址映射、内存保护与共享、虚拟内存等。
3. 文件管理  
文件存储空间的管理、目录管理、文件读写管理和保护等。
4. 设备管理  
完成用户的 I/O 请求，方便用户使用各种设备，并提高设备的利用率。
主要包括缓冲管理、设备分配、设备处理、虛拟设备等。

### 用户态和内核态
* 内核态与用户态是操作系统的两种运行级别
* 运行在用户态下的程序不能直接访问操作系统内核数据结构和程序。当我们在系统中执行一个程序时，大部分时间是运行在用户态下的，在其需要操作系统帮助完成某些它没有权力和能力完成的工作时就会切换到内核态。
* 处于用户态执行时，进程所能访问的内存空间和对象受到限制，其所处于占有的处理机是可被抢占的；而处于核心态执行中的进程，则能访问所有的内存空间和对象，且所占有的处理机是不允许被抢占的。
* 为了安全性。在cpu的一些指令中，有的指令如果用错，将会导致整个系统崩溃。分了内核态和用户态后，当用户需要操作这些指令时候，内核为其提供了API，可以通过系统调用陷入内核，让内核去执行这些操作。

### 用户态到内核态的转换

1. 系统调用   
这是用户进程主动要求切换到内核态的一种方式，用户进程通过系统调用申请操作系统提供的服务程序完成工作。而系统调用的机制其核心还是使用了操作系统为用户特别开放的一个中断来实现，例如Linux的ine 80h中断。 
2. 异常   
当CPU在执行运行在用户态的程序时，发现了某些事件不可知的异常，这是会触发由当前运行进程切换到处理此。异常的内核相关程序中，也就到了内核态，比如缺页异常。 
3. 外围设备的中断   
当外围设备完成用户请求的操作之后，会向CPU发出相应的中断信号，这时CPU会暂停执行下一条将要执行的指令，转而去执行中断信号的处理程序，如果先执行的指令是用户态下的程序，那么这个转换的过程自然也就发生了有用户态到内核态的切换。比如硬盘读写操作完成，系统会切换到硬盘读写的中断处理程序中执行后续操作等。 

### 中断
* 在中断出现之前，CPU对IO采用的是轮询的方式进行服务，这使的CPU纠结在某一个IO上，一直在等待它的响应，如果它不响应，CPU就在原地一直的等下去。这样就导致了其他IO口也在等待CPU的服务，如果某个IO出现了important or emergency affairs，CPU也抽不出身去响应这个IO。
* 中断控制的主要优点是只有在IO接口需要服务时才去响应它，使得CPU很淡定的做它自己的事情，只有IO口有需求的时候才去响应它。同时中断中也设计了中断优先级，来处理一些很紧急的事件。
* CPU获知了计算机中发生的某些事，暂停执行当前的程序，转而去执行处理该事件的程序，当这段程序执行完毕之后，CPU继续执行刚才的程序。整个过程称为中断处理
* 来自CPU外部的中断称为 外部中断，来自CPU内部的中断称为 内部中断。
* 外部中断按是否宕机可以分为 可屏蔽中断 和 不可屏蔽中断。
* 内部中断按中断是否正常又可分为 软中断 和 异常。

### 大内核和微内核
1. 大内核
   * 大内核是将操作系统功能作为一个紧密结合的整体放到内核。除了最基本的进程、线程管理、内存管理外，将文件系统，驱动，网络协议等等都集成在内核里面
   * 由于各模块共享信息，因此有很高的性能。
   * 缺点：稳定性差，开发过程中的bug经常会导致整个系统挂掉。
2. 微内核
   * 由于操作系统不断复杂，因此将一部分操作系统功能移出内核，从而降低内核的复杂性。内核中只有最基本的调度、内存管理。移出的部分根据分层的原则划分成若干服务，相互独立。
   * 在微内核结构下，操作系统被划分成小的、定义良好的模块，只有微内核这一个模块运行在内核态，其余模块运行在用户态。
   * 因为需要频繁地在用户态和核心态之间进行切换，所以会有一定的性能损失。
   * 稳定，驱动等的错误只会导致相应进程死掉，不会导致整个系统都崩溃 



